<script type="importmap">
  { "imports": { "my_mod": "./show.js"} }
</script>

<script type="module">
    import { loadStripe } from "@stripe/stripe-js";
    const stripe = await loadStripe("pk_test_51OI4pKSA51MYk112tB65X12eEz8F58ufocjFqJ4TrQOBB5j6TDvIqe0pjd67YMjJafYRGQvcODjBijL6AAglRds800nQaOlryr");
    console.log('stripe', stripe)
    const elements = stripe.elements();

    const card = elements.create("card");
    card.mount("#card-element");

    card.addEventListener("change", function (event) {
      const displayError = document.getElementById("card-errors");
      if (event.error) {
        displayError.textContent = event.error.message;
      } else {
        displayError.textContent = "";
      }
    });

    const form = document.getElementById("payment-form");
    form.addEventListener("submit", async function (event) {
      event.preventDefault();

      const { token, error } = await stripe.createToken(card);
      if (error) {
        const errorElement = document.getElementById("card-errors");
        errorElement.textContent = error.message;
      } else {

        console.log("=============token",token);
      }
    });

</script>


<%= form_tag product_payment_path(@product), method: 'post', id: 'payment-form' do %>
  <div class="form-row">
    <label for="card-element">
      Credit or debit card
    </label>
    <div id="card-element">
    </div>

    <div id="card-errors" role="alert"></div>
  </div>

  <button type="submit">Submit Payment</button>
<% end %>